extends ../layout

block content
  .max-w-md.mx-auto.bg-white.mt-10.p-8.rounded-2xl.shadow-xl
    h1.text-3xl.font-bold.text-blue-900.mb-6 Registrar Nueva Cama

    form(action="/camas", method="POST" class="space-y-6")
      div
        label.block.text-sm.font-medium.text-gray-700 Habitación
        select#id_habitacion(name="id_habitacion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          option(value="") Seleccionar Habitación
          each h in habitaciones
            option(value=h.id_habitacion)= `Hab: ${h.numero} (Ala: ${h.ala.nombre}, Tipo: ${h.tipo})`

      div
        label.block.text-sm.font-medium.text-gray-700 Número de Cama
        input(type="text", name="numero", placeholder="Ej: Cama 1, Cama A" required class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
      
      div
        label.block.text-sm.font-medium.text-gray-700 Estado Inicial
        select(name="estado" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          option(value="Libre") Libre
          option(value="En Limpieza") En Limpieza
          option(value="Fuera de Servicio") Fuera de Servicio
      
      div#generoAsignadoField(style="display:none;") // Oculto por defecto
        label.block.text-sm.font-medium.text-gray-700 Género Asignado (solo para habitaciones compartidas)
        select(name="genero_asignado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          option(value="") Mixto / No Asignado
          option(value="M") Masculino
          option(value="F") Femenino

      .flex.justify-end.space-x-4.mt-6
        a(href="/camas").bg-gray-600.hover:bg-gray-700.transition-colors.duration-300.text-white.font-semibold.py-2.px-4.rounded-md.shadow-md Cancelar
        button(type="submit").bg-blue-600.hover:bg-blue-700.transition-colors.duration-300.text-white.font-semibold.py-2.px-6.rounded-md.shadow-md Guardar Cama

block scripts
  script.
    const habitacionSelect = document.getElementById('id_habitacion');
    const generoAsignadoField = document.getElementById('generoAsignadoField');
    const generoAsignadoSelect = generoAsignadoField.querySelector('select[name="genero_asignado"]');
    const habitacionesData = !{JSON.stringify(habitaciones)}; 

    function toggleGeneroAsignado() {
      const selectedHabitacionId = habitacionSelect.value;
      const selectedHabitacion = habitacionesData.find(h => h.id_habitacion == selectedHabitacionId);

      if (selectedHabitacion && selectedHabitacion.tipo === 'Compartida') {
        generoAsignadoField.style.display = 'block';
      } else {
        generoAsignadoField.style.display = 'none';
        generoAsignadoSelect.value = ''; 
      }
    }

    habitacionSelect.addEventListener('change', toggleGeneroAsignado);
    document.addEventListener('DOMContentLoaded', toggleGeneroAsignado); 