extends ../layout

block content
  .max-w-4xl.mx-auto.bg-white.mt-10.p-8.rounded-2xl.shadow-xl
    h1.text-3xl.font-bold.text-blue-900.mb-6 Editar Admisión ##{admision.id_admision}
    
    // Información de paciente
    .mb-6.p-5.border.border-gray-200.rounded-lg.bg-gray-50
      h3.text-lg.font-semibold.text-gray-800.mb-3 Paciente Asociado
      p.text-gray-700.mb-2 #[strong Nombre Completo:] #{admision.paciente ? admision.paciente.nombre + ' ' + admision.paciente.apellido : 'N/A'}
      p.text-gray-700.mb-2 #[strong DNI:] #{admision.paciente ? admision.paciente.dni : 'N/A'}
      p.text-gray-700.mb-2 #[strong Género:] #{admision.paciente ? admision.paciente.genero : 'N/A'}
      p.text-gray-700.mb-2 #[strong Fecha de Ingreso:] #{admision.fecha_ingreso ? new Date(admision.fecha_ingreso).toLocaleString('es-ES') : 'N/A'}
      p.text-gray-700.mb-2 #[strong Estado:] 
        span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full(class=(admision.estado_admision === 'Activa' ? 'bg-green-100 text-green-800' : admision.estado_admision === 'Dada de Alta' ? 'bg-blue-100 text-blue-800' : admision.estado_admision === 'Cancelada' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800')) #{admision.estado_admision}

    form(action="/admisiones/actualizar/" + admision.id_admision, method="POST" class="space-y-6")

      // Detalles de la admision 
      div.space-y-4.p-5.border.border-gray-200.rounded-lg.bg-gray-50
        h3.text-lg.font-semibold.text-gray-800.mb-3 Detalles de la Admisión
        div
          label.block.text-sm.font-medium.text-gray-700 Motivo de Internación
          textarea(name="motivo_internacion", placeholder="Describa el motivo de la internación" required class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" rows="3")= admision.motivo_internacion

      // Reasignación de cama
      div.mb-6.p-5.border.border-gray-200.rounded-lg.bg-gray-50
        h3.text-lg.font-semibold.text-gray-800.mb-3 Reasignar Cama
        div
          label.block.text-sm.font-medium.text-gray-700 Cama Actualmente Asignada
          p.text-gray-800.font-medium.mb-2
            if admision.asignacionesCama && admision.asignacionesCama.length > 0 && admision.asignacionesCama[0].cama
              | Hab: #{admision.asignacionesCama[0].cama.habitacion.numero} (Ala: #{admision.asignacionesCama[0].cama.habitacion.ala.nombre}) - Cama: #{admision.asignacionesCama[0].cama.numero}
            else
              | Ninguna
        
        div
          label.block.text-sm.font-medium.text-gray-700 Cambiar a Cama
          select(name="id_cama_asignada_nueva" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
            option(value="") -- No cambiar de cama --
            each cama in camasDisponibles
              option(value=cama.id_cama)= `Hab: ${cama.habitacion.numero} (Ala: ${cama.habitacion.ala.nombre}) - Cama: ${cama.numero} ${cama.genero_asignado ? '(Género: ' + (cama.genero_asignado === 'M' ? 'Masculino' : 'Femenino') + ')' : '(Mixto/Individual)'}`

      .flex.justify-end.space-x-4.mt-6
        a(href="/admisiones/detalles/" + admision.id_admision).bg-gray-500.hover:bg-gray-600.transition-colors.duration-300.text-white.font-semibold.py-2.px-4.rounded-md.shadow-md Cancelar
        button(type="submit").bg-blue-600.hover:bg-blue-700.transition-colors.duration-300.text-white.font-semibold.py-2.px-6.rounded-md.shadow-md Actualizar Admisión