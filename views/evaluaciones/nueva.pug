extends ../layout

block content
  .max-w-4xl.mx-auto.bg-white.mt-10.p-8.rounded-2xl.shadow-xl
    h1.text-3xl.font-bold.text-blue-900.mb-6 Registrar Nueva Evaluación

    .mb-6.p-5.border.border-gray-200.rounded-lg.bg-gray-50
      h3.text-lg.font-semibold.text-gray-800.mb-3 Detalles de la Admisión
      p.mb-2 #[strong ID Admisión:] #{admision.id_admision}
      p.mb-2 #[strong Paciente:] #{admision.paciente ? admision.paciente.nombre + ' ' + admision.paciente.apellido + ' (DNI: ' + admision.paciente.dni + ')' : 'Paciente Desconocido'}
      p.mb-2 #[strong Fecha de Ingreso:] #{admision.fecha_ingreso ? new Date(admision.fecha_ingreso).toLocaleString('es-ES') : 'N/A'}
      p.mb-2 #[strong Motivo de Internación:] #{admision.motivo_internacion || 'N/A'}
      p.mb-2 #[strong Estado Actual:] 
        span(class=['px-2', 'inline-flex', 'text-sm', 'leading-5', 'font-semibold', 'rounded-full', admision.estado_admision === 'Activa' ? 'bg-green-100 text-green-800' : admision.estado_admision === 'Dada de Alta' ? 'bg-blue-100 text-blue-800' : admision.estado_admision === 'Cancelada' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800']) #{admision.estado_admision}

    form(action="/evaluaciones", method="POST", class="space-y-6")
      input(type="hidden", name="id_admision", value=admision.id_admision)

      div.space-y-4.p-5.border.border-gray-200.rounded-lg.bg-gray-50
        h3.text-lg.font-semibold.text-gray-800.mb-3 Datos de la Evaluación
        div
          label(for="id_medico", class="block text-sm font-medium text-gray-700") Médico Evaluador
          select(name="id_medico", id="id_medico", required, class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
            option(value="") Seleccionar Médico
            each medico in medicos
              option(value=medico.id_medico)= medico.nombre + ' ' + medico.apellido
        div
          label(for="diagnostico", class="block text-sm font-medium text-gray-700") Diagnóstico (Opcional)
          textarea(name="diagnostico", id="diagnostico", placeholder="Diagnóstico inicial o actualizado", rows="3", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
        div
          label(for="observaciones_medicas", class="block text-sm font-medium text-gray-700") Observaciones Médicas
          textarea(name="observaciones_medicas", id="observaciones_medicas", placeholder="Cualquier observación adicional del médico", rows="3", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
        
        h4.text-md.font-semibold.text-gray-800.mt-4 Signos Vitales
        div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
          div
            label(for="signos_vitales_pa", class="block text-sm font-medium text-gray-700") Presión Arterial (PA)
            input(type="text", name="signos_vitales_pa", id="signos_vitales_pa", placeholder="Ej: 120/80 mmHg", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          div
            label(for="signos_vitales_fc", class="block text-sm font-medium text-gray-700") Frecuencia Cardíaca (FC)
            input(type="text", name="signos_vitales_fc", id="signos_vitales_fc", placeholder="Ej: 75 lpm", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          div
            label(for="signos_vitales_fr", class="block text-sm font-medium text-gray-700") Frecuencia Respiratoria (FR)
            input(type="text", name="signos_vitales_fr", id="signos_vitales_fr", placeholder="Ej: 16 rpm", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
          div
            label(for="signos_vitales_temp", class="block text-sm font-medium text-gray-700") Temperatura (Temp)
            input(type="text", name="signos_vitales_temp", id="signos_vitales_temp", placeholder="Ej: 37.0 °C", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")
        
        div.mt-4
          label(for="plan_cuidados", class="block text-sm font-medium text-gray-700") Plan de Cuidados
          textarea(name="plan_cuidados", id="plan_cuidados", placeholder="Plan de cuidados de enfermería o médico", rows="4", class="w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500")

      .flex.justify-end.space-x-4.mt-6
        a(href=`/admisiones/detalles/${admision.id_admision}`, class="bg-gray-600 hover:bg-gray-700 transition-colors duration-300 text-white font-semibold py-2 px-4 rounded-md shadow-md") Cancelar
        button(type="submit", class="bg-purple-600 hover:bg-purple-700 transition-colors duration-300 text-white font-semibold py-2 px-6 rounded-md shadow-md") Guardar Evaluación